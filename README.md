# Прохождение стажировки

## Pereval Rest API

[ФСТР](https://pereval.online) заказала разработать мобильное приложение для Android и IOS. Пользоваться мобильным приложением будут туристы. В горах они будут вносить данные о перевале в приложение и отправлять их в ФСТР, как только появится доступ в Интернет.
Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от пользователей, а те в свою очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с объектами, внесёнными другими.

---
### Входное задание:
Когда турист поднимется на перевал, он сфотографирует его и внесёт нужную информацию с помощью мобильного приложения:
- _координаты объекта и его высоту;_
- _название объекта;_
- _несколько фотографий;_
- _информацию о пользователе, который передал данные о перевале:_
- _имя пользователя (ФИО строкой);_
- _почта;_
- _телефон._

После этого турист нажмёт кнопку «Отправить» в мобильном приложении. Мобильное приложение вызывает метод Pereval.

Метод Pereval принимает JSON в теле запроса с информацией о перевале. Ниже находится пример такого JSON-а:
```python

{
  "beauty_title": "пер. ",
  "title": "Пхия",
  "other_titles": "Триев",
  "connect": "connect",

  "add_time": "2021-09-22 13:18:13",
  "user": {"email": "qwerty@mail.ru",     
        "fam": "Пупкин",
     "name": "Василий",
     "otc": "Иванович",
        "phone": "+7 555 55 55"}, 
 
   "coords":{
  "latitude": "45.3842",
  "longitude": "7.1525",
  "height": "1200"},
 
  "level":{"winter": "1А",
           "summer": "1А",
           "autumn": "1А",
           "spring": "1А"},
 
   "images": [{"data":"<картинка1>", "title":"Седловина"}, {"data":"<картинка>", "title":"Подъём"}]
}
```
Результат метода: JSON

1. **status** — код HTTP, целое число:
- 500 — ошибка при выполнении операции;
- 400 — Bad Request (при нехватке полей);
- 200 — успех.
3. **message** — строка:
  - Причина ошибки (если она была);
  - Отправлено успешно;
  - Если отправка успешна, дополнительно возвращается id вставленной записи.
3. **id** — идентификатор, который был присвоен объекту при добавлении в базу данных.

Примеры:

_{ "status": 500, "message": "Ошибка подключения к базе данных","id": null}_

_{ "status": 200, "message": null, "id": 42 }_

После того, как турист с помощью мобильного приложения и твоего REST API добавит информацию о новом перевале, сотрудники ФСТР проведут модерацию для каждого нового объекта и поменяют поле status.

Допустимые значения поля status:
- _new_;
- _pending_ — если модератор взял в работу;
- _accepted_ — модерация прошла успешно;
- _rejected_ — модерация прошла, информация не принята.

---
***Метод***
```
POST/pereval/
```
Добавляет объект в бд

---
***Метод***
```
GET/pereval/{id}/
```
Выводит всю информацию об объекте по его id, в том числе статус модерации.

---
***Метод***
```
PATCH/pereval/{id}/
```
Отредактировать существующую запись, если она в статусе _new_.
Редактировать можно все поля, кроме тех, что содержат в себе ФИО, адрес почты и номер телефона. Метод принимает json.
В качестве результата возвращаются два значения:
1. state:
  - 1 — если успешно удалось отредактировать запись в базе данных.
  - 0 — в противном случае.
2. message — сообщение о причине неудачного изменения.

---
***Метод***
```
GET/pereval/?user__email={user_email}
```
Выводит список данных обо всех объектах, которые пользователь с почтой <email> отправил на сервер.
При реализации использована фильтрация по адресу электронной почты пользователя с помощью пакета django-filter

---
Документация сгенерирована при помощи пакета ***drf-yasg***
```
http://127.0.0.1:8000/swagger/
```

---
[Проект](https://miavien.pythonanywhere.com/swagger/) опубликован на хостинге pythonanywhere
```
https://miavien.pythonanywhere.com/swagger/
```
